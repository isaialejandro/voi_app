{% extends 'base/base.html' %}
{% load static from staticfiles %}

{% block title %}
    Dashboard
{% endblock %}

{% block extracss %}
    <link href="{% static 'css/plugins/dataTables/datatables.min.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="wrapper wrapper-content animated fadeInUp">
        <div class="container">
            <!--
            <div class="row">
                <div class="col-md-2">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <span class="label label-success pull-right">Monthly</span>
                            <h5>Views</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins">386,200</h1>
                            <div class="stat-percent font-bold text-success">98% <i class="fa fa-bolt"></i></div>
                            <small>Total views</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <span class="label label-info pull-right">Annual</span>
                            <h5>Orders</h5>
                        </div>
                        <div class="ibox-content">
                                    <h1 class="no-margins">80,800</h1>
                                    <div class="stat-percent font-bold text-info">20% <i class="fa fa-level-up"></i></div>
                                    <small>New orders</small>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <span class="label label-primary pull-right">Today</span>
                            <h5>visits</h5>
                        </div>
                        <div class="ibox-content">

                            <div class="row">
                                <div class="col-md-6">
                                    <h1 class="no-margins">$ 406,420</h1>
                                    <div class="font-bold text-navy">44% <i class="fa fa-level-up"></i> <small>Rapid pace</small></div>
                                </div>
                                <div class="col-md-6">
                                    <h1 class="no-margins">206,120</h1>
                                    <div class="font-bold text-navy">22% <i class="fa fa-level-up"></i> <small>Slow pace</small></div>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Monthly income</h5>
                            <div class="ibox-tools">
                                <span class="label label-primary">Updated 12.2015</span>
                            </div>
                        </div>
                        <div class="ibox-content no-padding">
                            <div class="flot-chart m-t-lg" style="height: 55px;">
                                <div class="flot-chart-content" id="flot-chart1"></div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8">
                    <div class="ibox float-e-margins">
                        <div class="ibox-content">
                            <div>
                                    <span class="pull-right text-right">
                                    <small>Average value of sales in the past month in: <strong>United states</strong></small>
                                        <br/>
                                        All sales: 162,862
                                    </span>
                                <h3 class="font-bold no-margins">
                                    Half-year revenue margin
                                </h3>
                                <small>Sales marketing.</small>
                            </div>

                            <div class="m-t-sm">

                                <div class="row">
                                    <div class="col-md-8">
                                        <div>
                                        <canvas id="lineChart" height="114"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <ul class="stat-list m-t-lg">
                                            <li>
                                                <h2 class="no-margins">2,346</h2>
                                                <small>Total orders in period</small>
                                                <div class="progress progress-mini">
                                                    <div class="progress-bar" style="width: 48%;"></div>
                                                </div>
                                            </li>
                                            <li>
                                                <h2 class="no-margins ">4,422</h2>
                                                <small>Orders in last month</small>
                                                <div class="progress progress-mini">
                                                    <div class="progress-bar" style="width: 60%;"></div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                            </div>

                            <div class="m-t-md">
                                <small class="pull-right">
                                    <i class="fa fa-clock-o"> </i>
                                    Update on 16.07.2015
                                </small>
                                <small>
                                    <strong>Analysis of sales:</strong> The value has been changed over time, and last month reached a level over $50,000.
                                </small>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <span class="label label-warning pull-right">Data has changed</span>
                            <h5>User activity</h5>
                        </div>
                        <div class="ibox-content">
                            <div class="row">
                                <div class="col-xs-4">
                                    <small class="stats-label">Pages / Visit</small>
                                    <h4>236 321.80</h4>
                                </div>

                                <div class="col-xs-4">
                                    <small class="stats-label">% New Visits</small>
                                    <h4>46.11%</h4>
                                </div>
                                <div class="col-xs-4">
                                    <small class="stats-label">Last week</small>
                                    <h4>432.021</h4>
                                </div>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <div class="row">
                                <div class="col-xs-4">
                                    <small class="stats-label">Pages / Visit</small>
                                    <h4>643 321.10</h4>
                                </div>

                                <div class="col-xs-4">
                                    <small class="stats-label">% New Visits</small>
                                    <h4>92.43%</h4>
                                </div>
                                <div class="col-xs-4">
                                    <small class="stats-label">Last week</small>
                                    <h4>564.554</h4>
                                </div>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <div class="row">
                                <div class="col-xs-4">
                                    <small class="stats-label">Pages / Visit</small>
                                    <h4>436 547.20</h4>
                                </div>

                                <div class="col-xs-4">
                                    <small class="stats-label">% New Visits</small>
                                    <h4>150.23%</h4>
                                </div>
                                <div class="col-xs-4">
                                    <small class="stats-label">Last week</small>
                                    <h4>124.990</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            -->

            {% if messages %}
                {% for message in messages %}

                    <div class="alert alert-success">
                        {{message}}.
                    </div>
                {% endfor %}
            {% endif %}

            <div class="row">

                {% if perms.ticket.view_ticket_list %}
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Pending Tickets </h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <div class="row">
                                <!--
                                    <div class="col-sm-3">
                                        <div class="input-group"><input type="text" placeholder="Search" class="input-sm form-control"> <span class="input-group-btn">
                                        <button type="button" class="btn btn-sm btn-primary"> Go!</button> </span></div>
                                    </div>
                                -->
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-striped" id="table">
                                        <thead>
                                            <tr>
                                                <th>Title</th>
                                                <th>Folio</th>
                                                <th>Priority </th>
                                                <th>Status </th>
                                                <th>Reg Date </th>
                                                <th>Applicant </th>
                                                <th>Current App </th>
                                                <th>Assigned To </th>
                                                <th>Actions </th>

                                                {% if user.is_superuser %}
                                                    <th>User </th>
                                                {% endif %}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for ticket in pending_tickets %}
                                                <tr>
                                                    <td>{{ ticket.title }}</td>
                                                    <td>{{ ticket.folio_number }}</td>
                                                    <td>
                                                      <span
                                                        {% if ticket.priority == 'low' %}
                                                          class="label label-info"
                                                        {% elif ticket.priority == 'mid' %}
                                                          class="label label-warning"
                                                        {% elif ticket.priority == 'high' %}
                                                          class="label label-danger"
                                                        {% endif %}
                                                      >
                                                        {{ ticket.priority|upper }}
                                                      </span>
                                                    </td>
                                                    <td>
                                                        <!--<a href="#" onClick="changeCurrentUser({{ticket.id}});">-->
                                                            <span
                                                                {% if ticket.status == 'open' %}
                                                                    class="label label-primary"
                                                                {% elif ticket.status == 'pending' %}
                                                                    class="label label-warning"
                                                                {% elif ticket.status == 'in progress' %}
                                                                    class="label label-info"
                                                                {% elif ticket.status == 'closed' %}
                                                                    class="label label-default"
                                                                {% elif ticket.status == 'assigned' %}
                                                                    class="label label-info"
                                                                {% elif ticket.status == 'provider approval proccess' %}
                                                                class="label label-danger"
                                                                {% endif %}
                                                            >

                                                                {{ ticket.status|upper }}

                                                            </span>
                                                        <!--</a>-->
                                                    </td>
                                                    <td>{{ ticket.registry_date }}</td>
                                                    <td>{{ ticket.applicant }}</td>
                                                    <td>{{ ticket.application }}</td>
                                                    <td>
                                                        <a href="#" onClick="ChangeCurrentUser({{ticket.id}});">
                                                            <span class="label label-success">
                                                                {{ ticket.assigned_to }}
                                                            </span>
                                                        </a>
                                                    </td>


                                                    <td align="center">
                                                        {% if perms.ticket.close_ticket %}
                                                            <a href="#" onClick="CloseCurrentTicket({{ticket.id}}, '{{ticket.folio_number}}');"><i class="fa fa-check text-navy a_close"></i></a>
                                                            &nbsp;
                                                        {% endif %}
                                                        {% if perms.ticket.change_ticket %}
                                                            <a href="{% url 'ticket:update' ticket.id %}"><i class="fa fa-pencil square"></i></a>
                                                        {% endif %}
                                                        {% if perms.ticket.can_view_ticket_detail %}
                                                            &nbsp;
                                                            <a href="{% url 'ticket:detail' ticket.id %}"><i class="fa fa-list-ul"></i></a>
                                                        {% endif %}
                                                    </td>

                                                    {% if user.is_superuser %}
                                                        <th>{{ ticket.user }} </th>
                                                    {% endif %}
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}

                {% endif %}

            </div>
        </div>
    </div>
{% endblock %}

{% block extrajs %}
    <script src="{% static 'js/plugins/dataTables/datatables.min.js' %}"></script>

    <script>
        function CloseCurrentTicket(id, folio_no){

          var title = 'Close current ticket';
          var content = 'Are you sure want to close the ticket <b>' + folio_no + ' </b>?' +
                        '<br>'+
                        '<br>'+
                        '<input id="close_comment" name="close_comment" type="text" placeholder="Enter a comment" class="form-control">';
          var btn = '<button id="btn_modal_close" class="btn btn-sm btn-danger pull-right m-t-n-xs" type="button"><strong>Close</strong></button>';
          //Creating args tuple for diff keywords.
          var args = [];
          args = {"id": id, "user_id": {{user.id}}}
          ShowModal(title, content, args, btn);
        }

        function ChangeCurrentUser(){
            alert('Pending');
        }

        $(document).ready(function(){
            $('.table').DataTable({
                pageLength: 10,
                responsive: true,
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                    {
                        extend: 'copy'
                    },
                    {
                        extend: 'csv', title: 'TicketHistory'
                    },
                    /*{extend: 'excel', title: 'ExampleFile'},
                    {extend: 'pdf', title: 'ExampleFile'},

                    {
                        extend: 'print',
                        customize: function (win){
                                $(win.document.body).addClass('white-bg');
                                $(win.document.body).css('font-size', '10px');

                                $(win.document.body).find('table')
                                        .addClass('compact')
                                        .css('font-size', 'inherit');
                        }
                    }*/
                ]
            });
        });
    </script>
{% endblock %}
